<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Triangle Grid Image Toggle with Save</title>
<style>
  canvas {
    border: 1px solid #333;
    display: block;
  }
</style>
</head>
<body>

<canvas id="triangleGrid" width="1200" height="800"></canvas>
<button id="saveBtn">Save as PNG</button>

<script>
const canvas = document.getElementById('triangleGrid');
const ctx = canvas.getContext('2d');

const cols = 6;
const rows = 4;
const triSize = 100;
const triHeight = triSize * Math.sqrt(3) / 2;

// Image sources (served from a local server, not C:/ directly)
const imageSources = [
  'https://media.discordapp.net/attachments/672171149387628564/1386409256366116894/UpEmpty.png?ex=685999bc&is=6858483c&hm=5fb40337bf2a402a4c22d4229d9e7e705febc373ae6faeafaf0bf00747affebe&=&format=webp&quality=lossless&width=881&height=762',
  'https://media.discordapp.net/attachments/672171149387628564/1386409257087402106/UpFilled.png?ex=685999bd&is=6858483d&hm=0f9a7b49510dc4a11fa234424a3ae57406c973a403b8ae325ba468a7def97ef4&=&format=webp&quality=lossless&width=881&height=762',
  'https://media.discordapp.net/attachments/672171149387628564/1386409256701657288/UpEnd.png?ex=685999bd&is=6858483d&hm=78993a292aff22ed236c4331e1a3c6f2c7340a90aaa5429faf4e22feecf037b7&=&format=webp&quality=lossless&width=875&height=762',
  'https://media.discordapp.net/attachments/672171149387628564/1386409257360163048/UpStart.png?ex=685999bd&is=6858483d&hm=bfd8f8155426f2619110c19dad8ae2691ce92ebe9f7920bff5d68bf845462306&=&format=webp&quality=lossless&width=875&height=762'
];
const otherimageSources = [
  'https://media.discordapp.net/attachments/672171149387628564/1386409257674477618/DownEmpty.png?ex=685999bd&is=6858483d&hm=34687950f9101d5189146d72ce42f3b9c2d2c86667edd36a0dc18e37b6641094&=&format=webp&quality=lossless&width=881&height=762',
  'https://media.discordapp.net/attachments/672171149387628564/1386409255862534235/DownFilled.png?ex=685999bc&is=6858483c&hm=f059e1911b1fda9564fe86f47cc52e9edb49841e829398dd50d3d3d2d58f1ff9&=&format=webp&quality=lossless&width=881&height=762',
  'https://media.discordapp.net/attachments/672171149387628564/1386409256135295016/DownStart.png?ex=685999bc&is=6858483c&hm=cd4eccdf59ea38c1695d11fb06a5c016cf80b610eb37a60bc87077974e8b8db3&=&format=webp&quality=lossless&width=875&height=762',
  'https://media.discordapp.net/attachments/672171149387628564/1386409257938980995/DownEndA.png?ex=685999bd&is=6858483d&hm=86c7c21cc248cafacd74877b78a001c21fe3cbcc7c31af334d81312435758889&=&format=webp&quality=lossless&width=875&height=762'

];

const otherimages = [];
let otherimagesLoaded = 0;
const images = [];
let imagesLoaded = 0;

// Preload images
imageSources.forEach(src => {
  const img = new Image();
  img.src = src;
  img.onload = () => {
    imagesLoaded++;
    if (imagesLoaded === imageSources.length) {
      createGrid();
      drawGrid();
    }
  };
  images.push(img);
});

// Preload images
otherimageSources.forEach(src => {
  const img = new Image();
  img.src = src;
  img.onload = () => {
    otherimagesLoaded++;
    if (otherimagesLoaded === otherimageSources.length) {
      createGrid();
      drawGrid();
    }
  };
  otherimages.push(img);
});

const triangles = [];

function createGrid() {
  for (let row = 0; row < rows; row++) {
    for (let col = 0; col < cols; col++) {
      const x = col * (triSize * 0.5 );
      const y = row * (triHeight*1.15);
      const pointingUp = (row + col) % 2 === 0;

      triangles.push({
        x,
        y,
        pointingUp,
        imageIndex: 0
      });
    }
  }
}



function drawTriangle(tri) {
  const img = images[tri.imageIndex];
  const oimg = otherimages[tri.imageIndex]
  ctx.save();

  ctx.translate(tri.x + triSize / 2, tri.y + triHeight / 2); // center of the triangle area

  if (tri.pointingUp) {
      // Draw the image stretched to fit triangle width and correct height
    ctx.drawImage(img, 
    -triSize / 2, 
    -triHeight / 2, 
    triSize, 
    triHeight);

  } else {
    // Draw the image stretched to fit triangle width and correct height
    ctx.drawImage(oimg, 
    -triSize / 2, 
    -triSize / 2, 
    triSize, 
    triHeight);
  }

  ctx.restore();

}
function drawGrid() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  triangles.forEach(drawTriangle);
}

function pointInTriangle(px, py, ax, ay, bx, by, cx, cy) {
  const v0x = cx - ax, v0y = cy - ay;
  const v1x = bx - ax, v1y = by - ay;
  const v2x = px - ax, v2y = py - ay;

  const dot00 = v0x * v0x + v0y * v0y;
  const dot01 = v0x * v1x + v0y * v1y;
  const dot02 = v0x * v2x + v0y * v2y;
  const dot11 = v1x * v1x + v1y * v1y;
  const dot12 = v1x * v2x + v1y * v2y;

  const invDenom = 1 / (dot00 * dot11 - dot01 * dot01);
  const u = (dot11 * dot02 - dot01 * dot12) * invDenom;
  const v = (dot00 * dot12 - dot01 * dot02) * invDenom;

  return (u >= 0) && (v >= 0) && (u + v <= 1);
}

canvas.addEventListener('click', e => {
  const rect = canvas.getBoundingClientRect();
  const clickX = e.clientX - rect.left;
  const clickY = e.clientY - rect.top;

  for (const tri of triangles) {
    let ax, ay, bx, by, cx, cy;
    if (tri.pointingUp) {
      ax = tri.x;
      ay = tri.y + triHeight;
      bx = tri.x + triSize / 2;
      by = tri.y;
      cx = tri.x + triSize;
      cy = tri.y + triHeight;
    } else {
      ax = tri.x;
      ay = tri.y;
      bx = tri.x + triSize / 2;
      by = tri.y + triHeight;
      cx = tri.x + triSize;
      cy = tri.y;
    }

    if (pointInTriangle(clickX, clickY, ax, ay, bx, by, cx, cy)) {
      tri.imageIndex = (tri.imageIndex + 1) % images.length;
      drawGrid();
      break;
    }
  }
});

document.getElementById('saveBtn').addEventListener('click', () => {
  const link = document.createElement('a');
  link.download = 'triangle_grid.png';
  link.href = canvas.toDataURL('image/png');
  link.click();
});

</script>

</body>
</html>
